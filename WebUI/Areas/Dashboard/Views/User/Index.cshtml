@using System.Security.Claims
@inject IHttpContextAccessor _contextAccessor;
@model List<GetUsersDTO>
<div asp-validation-summary="All" class="text text-danger"></div>




<table id="example" class="display table table-striped table-responsive-md" style="width:100%">
    <thead>
        <tr>

            <th>№</th>
            <th>@_localization.GetKey("DashboardUserIndex0")</th>
            <th>@_localization.GetKey("DashboardUserIndex1")</th>

            <th>@_localization.GetKey("DashboardUserIndex2")</th>

            <th>@_localization.GetKey("DashboardUserIndex3")</th>

            <th>@_localization.GetKey("DashboardUserIndex4")</th>

            <th>@_localization.GetKey("DashboardAuditoriumIndex1")</th>




        </tr>

    </thead>
    <tbody id="parent">
        @{
            int counter = 0;
        }
        @foreach (var user in Model)
        {
          
            counter++;
            <tr>

                <td>@counter</td>
                <td>@user.FirstName @user.LastName</td>
                <td>@user.Email</td>
                <td>@user.PhoneNumber</td>
                <td>
                    @{
                        int a = 0;
                    }
                    @foreach (var role in user.Roles)
                    {

                       


                      


                            @role
                      
                        if (0 < user.Roles.Count - a)
                        {
                            @Html.Raw(",")
                        }
                        a++;
                    }
                </td>
                <td style="overflow-y:scroll;max-height:100px;">
                    @{
                        int b = 0;
                    }
                    @foreach (var confrance in user.Conferances)
                    {






                     
                        @confrance
                        if (0 < user.Conferances.Count - b)
                        {
                            @Html.Raw(",")
                        }
                        <br/>
                        b++;
                    }
                </td>
                <td>
                    @if (_contextAccessor.HttpContext.User.FindFirst(ClaimTypes.NameIdentifier).Value!=user.Id)
                    {
                        <button class="btn btn-outline-danger" onclick="userDelet('@user.Id')"><i class="fa-solid fa-trash"></i></button>
                        <a class="btn btn-outline-success" href="/dashboard/user/addRole/@user.Id">@_localization.GetKey("DashboardUserIndex5")</a>
                        <a class="btn btn-outline-warning" href="/dashboard/user/UserDeleteRole/@user.Id">@_localization.GetKey("DashboardUserIndex6")</a>
                    }

                </td>
            </tr>

        }
    </tbody>

    <tfoot>
        <tr>

            <th>№</th>
            <th>@_localization.GetKey("DashboardUserIndex0")</th>
            <th>@_localization.GetKey("DashboardUserIndex1")</th>

            <th>@_localization.GetKey("DashboardUserIndex2")</th>

            <th>@_localization.GetKey("DashboardUserIndex3")</th>

            <th>@_localization.GetKey("DashboardUserIndex4")</th>

            <th>@_localization.GetKey("DashboardAuditoriumIndex1")</th>



        </tr>

    </tfoot>
</table>

<script>
    let table = new DataTable('#example', {
        responsive: true
    });
    function userDelet(id) {
        swal({
            title: "Silmək İstədiynizə əminsiniz?",

            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
            .then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        url:`/dashboard/user/delete/${id}`,
                        method:"Post",
                        success: function (response) {
                            swal("Silindi!", {
                                icon: "success",
                            }).then((e) => {

                                if (e) {
                                    window.location.reload();

                                }
                            })
                        },
                        error: function () {
                            swal("Proses Düzgun getmedi", "error");
                        }
                    })

                }
            });
    }
</script>